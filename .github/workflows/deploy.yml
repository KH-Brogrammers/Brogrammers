name: Deploy to Production

on:
  workflow_call:
    secrets:
      BROGRAMMERS_VPN:
        required: true
      SSH_PRIVATE_KEY:
        required: true
      SSH_KEY:
        required: true
      SSH_PASSWORD:
        required: true
      USERNAME:
        required: true
      WORK_FOLDER:
        required: true

jobs:
  Deploy:
    name: Deploy to Server
    runs-on: self-hosted
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ðŸ“¦ Download deployment artifact
      uses: actions/download-artifact@v4
      with:
        name: deployment-build-latest
        path: ./deployment-package
    
    - name: ðŸš€ Execute Deployment Script
      run: |
        chmod +x ./.github/scripts/deploy.sh
        WORK_FOLDER="${{ secrets.WORK_FOLDER }}" \
        BROGRAMMERS_VPN="${{ secrets.BROGRAMMERS_VPN }}" \
        USERNAME="${{ secrets.USERNAME }}" \
        SSH_PRIVATE_KEY="${{ secrets.SSH_PRIVATE_KEY }}" \
        SSH_KEY="${{ secrets.SSH_KEY }}" \
        SSH_PASSWORD="${{ secrets.SSH_PASSWORD }}" \
        ./.github/scripts/deploy.sh
