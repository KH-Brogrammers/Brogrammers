name: Deploy to Production

on:
  workflow_call:
    secrets:
      PUBLIC_IP:
        required: true
      SSH_PUBLIC_KEY:
        required: true
      SSH_PRIVATE_KEY:
        required: true
      SSH_LOGIN_PASSWORD:
        required: true
      USERNAME:
        required: true

jobs:
  Deploy:
    name: Deploy to Server
    runs-on: self-hosted
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ðŸ“¦ Download deployment artifact
      uses: actions/download-artifact@v4
      with:
        name: deployment-build-latest
        path: ./deployment-package
    
    - name: ðŸš€ Execute Deployment Script
      run: |
        chmod +x ./.github/scripts/deploy.sh
        PUBLIC_IP="${{ secrets.PUBLIC_IP }}" \
        USERNAME="${{ secrets.USERNAME }}" \
        SSH_PRIVATE_KEY="${{ secrets.SSH_PRIVATE_KEY }}" \
        SSH_PUBLIC_KEY="${{ secrets.SSH_PUBLIC_KEY }}" \
        SSH_LOGIN_PASSWORD="${{ secrets.SSH_LOGIN_PASSWORD }}" \
        ./.github/scripts/deploy.sh
